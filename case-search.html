---
layout: page
title: SCOTUS Case Search
show_breadcrumbs: true
breadcrumb_parent: Home
breadcrumb_parent_url: /
---

<h1>SCOTUS Case Search</h1>

<section id="category-section">
  <h2>Browse by Topic</h2>
  <div id="categories" class="category-buttons"></div>
</section>

<form id="search-form">
  <input id="query" placeholder="Search case names or textâ€¦" required />
  <button type="submit">Search</button>
</form>

<div id="results"></div>
<div id="case-details"></div>

<script>
// CourtListener API token injected at build time via COURTLISTENER_TOKEN env var
const CL_TOKEN = '{{ site.COURTLISTENER_TOKEN | default: "" }}';

const categories = [
  { code: 1, label: 'Criminal Procedure' },
  { code: 2, label: 'Civil Rights' },
  { code: 3, label: 'First Amendment' },
  { code: 4, label: 'Due Process' },
  { code: 5, label: 'Privacy' },
  { code: 6, label: 'Attorneys' },
  { code: 7, label: 'Unions' },
  { code: 8, label: 'Economic Activity' },
  { code: 9, label: 'Judicial Power' },
  { code: 10, label: 'Federalism' },
  { code: 11, label: 'Interstate Relations' },
  { code: 12, label: 'Federal Taxation' },
  { code: 13, label: 'Miscellaneous' },
  { code: 14, label: 'Private Action' }
];

const form = document.getElementById('search-form');
const resultsDiv = document.getElementById('results');
const detailsDiv = document.getElementById('case-details');
const categoryDiv = document.getElementById('categories');

categories.forEach((cat) => {
  const btn = document.createElement('button');
  btn.type = 'button';
  btn.className = 'category-btn';
  btn.textContent = cat.label;
  btn.addEventListener('click', () => {
    runSearch(`scdb_issue_area=${cat.code}`);
  });
  categoryDiv.appendChild(btn);
});

form.addEventListener('submit', (e) => {
  e.preventDefault();
  const q = document.getElementById('query').value.trim();
  if (!q) return;
  // CourtListener expects `search` for full-text queries
  runSearch(`search=${encodeURIComponent(q)}`);
});

function buildHeaders() {
  const headers = {
    'User-Agent': 'USARLegalDirectory/1.0 (+https://github.com/USARscotus/legal-directory)'
  };
  if (CL_TOKEN) headers['Authorization'] = `Token ${CL_TOKEN}`;
  return headers;
}

async function runSearch(queryString) {
  resultsDiv.textContent = 'Searching...';
  detailsDiv.innerHTML = '';
  try {
    const url = `https://www.courtlistener.com/api/rest/v3/opinions/?${queryString}&court=scotus&order_by=date_filed`;
    const res = await fetch(url, { headers: buildHeaders() });
    if (!res.ok) throw new Error(`${res.status} ${res.statusText}`);
    const data = await res.json();
    if (!data.results || !Array.isArray(data.results) || !data.results.length) {
      resultsDiv.textContent = 'No cases found.';
      return;
    }
    renderResults(data.results);
  } catch (err) {
    console.error('Search failed', err);
    if (!CL_TOKEN) {
      resultsDiv.textContent = 'Missing COURTLISTENER_TOKEN configuration.';
    } else {
      resultsDiv.textContent = `Unable to fetch results: ${err.message}`;
    }
  }
}

function renderResults(cases) {
  resultsDiv.innerHTML = '';
  if (!cases.length) {
    resultsDiv.textContent = 'No cases found.';
    return;
  }
  const ul = document.createElement('ul');
  cases.forEach((op) => {
    const li = document.createElement('li');
    const link = document.createElement('a');
    const name = op.case_name || op.citation || `Case ${op.id}`;
    link.href = '#';
    link.textContent = `${name} (${op.date_filed || 'n.d.'})`;
    link.addEventListener('click', (evt) => {
      evt.preventDefault();
      loadCase(op.id);
    });
    li.appendChild(link);
    ul.appendChild(li);
  });
  resultsDiv.appendChild(ul);
}

async function loadCase(id) {
  resultsDiv.innerHTML = '';
  detailsDiv.textContent = 'Loading case...';
  try {
    const res = await fetch(`https://www.courtlistener.com/api/rest/v3/opinions/${id}/`, { headers: buildHeaders() });
    if (!res.ok) throw new Error(`${res.status} ${res.statusText}`);
    const data = await res.json();
    detailsDiv.innerHTML = '';
    const title = data.case_name || data.citation || `Case ${id}`;
    const header = document.createElement('h2');
    header.textContent = title;
    detailsDiv.appendChild(header);
    const meta = document.createElement('p');
    meta.textContent = `Decided: ${data.date_filed || 'Unknown'}`;
    detailsDiv.appendChild(meta);
    if (data.cites_to && data.cites_to.length) {
      const h3 = document.createElement('h3');
      h3.textContent = 'Citations';
      detailsDiv.appendChild(h3);
      const list = document.createElement('ul');
      data.cites_to.forEach((cite) => {
        if (cite.opinions && cite.opinions.length) {
          const citedId = cite.opinions[0];
          const li = document.createElement('li');
          const a = document.createElement('a');
          a.href = '#';
          a.textContent = cite.cite;
          a.addEventListener('click', (e) => {
            e.preventDefault();
            loadCase(citedId);
          });
          li.appendChild(a);
          list.appendChild(li);
        }
      });
      detailsDiv.appendChild(list);
    }
  } catch (err) {
    console.error('Case load failed', err);
    detailsDiv.textContent = `Unable to load case: ${err.message}`;
  }
}
</script>
