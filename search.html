---
layout: page
title: Search Results
show_breadcrumbs: true
breadcrumb_parent: Home
breadcrumb_parent_url: /
---

<h1>Search Results</h1>
<p id="search-results-count"></p>
<ul id="search-results"></ul>

<script src="https://unpkg.com/lunr/lunr.js"></script>
<script>
    const params = new URLSearchParams(window.location.search);
    const query = params.get("q");

    console.log("Search query:", query);

    if (query) {
        document.title = `Search: ${query}`;

        fetch("{{ site.baseurl }}/search.json")
            .then(res => res.json())
            .then(docs => {
                console.log("Fetched documents:", docs);

                const idx = lunr(function () {
                    this.ref("url");
                    this.field("title");
                    this.field("content");

                    docs.forEach(doc => {
                        const loweredDoc = {
                            url: doc.url,
                            title: (doc.title || "").toLowerCase(),
                            content: (doc.content || "").toLowerCase()
                        };
                        console.log("Indexing document:", loweredDoc);
                        this.add(loweredDoc);
                    });
                });

                const results = idx.search(query.toLowerCase());
                console.log("Search results:", results);

                const container = document.getElementById("search-results");
                const count = document.getElementById("search-results-count");

                if (results.length > 0) {
                    count.textContent = `${results.length} result${results.length !== 1 ? "s" : ""} found for “${query}”`;
                    results.forEach(result => {
                        const match = docs.find(d => d.url === result.ref);
                        console.log("Matched document:", match);
                        const item = document.createElement("li");
                        item.innerHTML = `<a href="${match.url}">${match.title}</a>`;
                        container.appendChild(item);
                    });
                } else {
                    console.warn(`No results found for query: ${query}`);
                    count.textContent = `No results found for “${query}”`;
                }
            })
            .catch(error => {
                console.error("Failed to load search.json or process search:", error);
            });
    } else {
        console.warn("No query parameter provided in the URL.");
        document.getElementById("search-results-count").textContent = "No query provided.";
    }
</script>
